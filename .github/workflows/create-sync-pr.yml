# .github/workflows/create-sync-pr.yml

name: 'Sync: Create PR from test to main'

# è§¦å‘æ¡ä»¶
on:
  schedule:
    # åŒ—äº¬æ—¶é—´æ¯å‘¨ä¸€ä¸Šåˆ 9 ç‚¹ï¼ˆUTC æ—¶é—´å‡Œæ™¨ 1 ç‚¹ï¼‰è¿è¡Œ
    - cron: '0 1 * * 1'
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  # ç¬¬ä¸€éƒ¨åˆ†ï¼šåˆ›å»ºæˆ–æ›´æ–° Pull Request
  create_pull_request:
    runs-on: ubuntu-latest
    outputs:
      # è¾“å‡º PR å·ç ï¼Œä¾›åç»­ä»»åŠ¡ä½¿ç”¨
      pr_number: ${{ steps.cpr.outputs.pull-request-number }}
    steps:
      - name: Create Pull Request from test to main
        id: cpr
        uses: peter-evans/create-pull-request@v4
        with:
          # ä½¿ç”¨ GitHub App çš„ Tokenï¼Œæƒé™æ›´å®‰å…¨
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "chore: sync test branch to main"
          title: "ğŸ¤– Sync: Merge `test` into `main`"
          body: |
            This is an automated PR to sync changes from the `test` branch to `main`.
            
            **Review carefully before merging!**
            
            - Vercel preview will be available below.
            - All checks must pass before this can be merged.
          head: test  # æºåˆ†æ”¯
          base: main  # ç›®æ ‡åˆ†æ”¯
          labels: "automated-pr, sync" # è‡ªåŠ¨ç»™ PR æ‰“ä¸Šæ ‡ç­¾ï¼Œæ–¹ä¾¿è¿‡æ»¤
          assignees: "424635328" # è‡ªåŠ¨æŒ‡æ´¾ç»™ä½ è‡ªå·±å®¡æŸ¥
          reviewers: "424635328" # è‡ªåŠ¨è¯·æ±‚ä½ å®¡æŸ¥
          draft: false # åˆ›å»ºä¸€ä¸ªå¯ç›´æ¥å®¡æŸ¥çš„ PRï¼Œè€Œä¸æ˜¯è‰ç¨¿
          update: true # å¦‚æœå·²å­˜åœ¨ç›¸åŒçš„PRï¼Œåˆ™æ›´æ–°å®ƒè€Œä¸æ˜¯åˆ›å»ºæ–°çš„

  # ç¬¬äºŒéƒ¨åˆ†ï¼šåœ¨ PR ä¸Šè¿è¡Œæ£€æŸ¥ (æµ‹è¯•å’Œæ„å»º)
  # æ³¨æ„ï¼šè¿™ä¸ª job ä¼šå› ä¸º PR çš„åˆ›å»ºè€Œè‡ªåŠ¨è§¦å‘ï¼Œæˆ‘ä»¬è¿™é‡Œå®šä¹‰å®ƒï¼Œç¡®ä¿å®ƒè¢«æ­£ç¡®æ‰§è¡Œ
  # æˆ‘ä»¬éœ€è¦å¦ä¸€ä¸ªå·¥ä½œæµæ–‡ä»¶æ¥å¤„ç† PR äº‹ä»¶ï¼Œè¿™æ ·æ›´ç¬¦åˆ GitHub Actions çš„è®¾è®¡æ¨¡å¼
  # è¿™é‡Œåªæ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼ŒçœŸæ­£çš„æ£€æŸ¥åº”è¯¥åœ¨ä¸€ä¸ªç›‘å¬ pull_request äº‹ä»¶çš„å·¥ä½œæµä¸­
  # æˆ‘ä»¬å°†åœ¨ä¸‹é¢åˆ›å»ºè¿™ä¸ªæ–‡ä»¶